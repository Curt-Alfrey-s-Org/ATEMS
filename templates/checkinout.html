{% extends "base.html" %}
{% block title %}Check In/Out{% endblock %}
{% block page_title %}Check In / Check Out{% endblock %}
{% block content %}
<div class="max-w-xl mx-auto">
  <p class="text-slate-400 mb-6">Scan or enter badge + tool. Same form for both — system toggles based on current state.</p>

  <div class="bg-slate-800/80 border border-slate-700 rounded-xl p-6 lg:p-8">
    <!-- Barcode/QR scan: scanner (keyboard wedge) or camera -->
    <div class="mb-6 p-4 rounded-lg bg-slate-900/50 border border-slate-600">
      <label for="scanInput" class="block text-sm font-medium text-slate-300 mb-2">Scan barcode/QR (tool, then badge)</label>
      <div class="flex gap-2 flex-wrap">
        <input type="text" id="scanInput" autocomplete="off" placeholder="Scan tool ID, then badge — or use camera"
               class="input-atems flex-1 min-w-[200px] px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-sky-500">
        <button type="button" id="scanCameraBtn" class="px-4 py-3 rounded-lg bg-slate-700 hover:bg-slate-600 border border-slate-600 text-slate-200 font-medium">
          Scan with camera
        </button>
      </div>
      <p class="text-slate-500 text-xs mt-2">Handheld scanner: scan tool first, then badge. Camera: point at QR or barcode.</p>
    </div>

    <form id="myForm" method="POST" action="{{ url_for('main.checkinout') }}" class="space-y-5">
      {{ form.hidden_tag() }}
      <div>
        <label for="username" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="username">Username</label>
        <input type="text" id="username" name="username" required autocomplete="username"
               class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
               placeholder="Enter or scan username">
      </div>
      <div>
        <label for="badge_id" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="badge-id">Badge ID</label>
        <input type="text" id="badge_id" name="badge_id" required
               class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
               placeholder="Scan or enter badge">
      </div>
      <div>
        <label for="tool_id_number" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="tool-id">Tool ID</label>
        <input type="text" id="tool_id_number" name="tool_id_number" required
               class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
               placeholder="Scan or enter tool ID">
      </div>
      <div>
        <label for="job_id" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="job-id">Job/Project ID <span class="text-slate-500">(optional)</span></label>
        <input type="text" id="job_id" name="job_id"
               class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
               placeholder="e.g. JOB-2024-001">
      </div>
      <div>
        <label for="condition" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="condition">Condition <span class="text-slate-500">(optional)</span></label>
        <select id="condition" name="condition" class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2">
          <option value="">— Select (optional) —</option>
          <option value="Good">Good</option>
          <option value="Fair">Fair</option>
          <option value="Damaged">Damaged</option>
        </select>
      </div>
      <div>
        <label for="return_by" class="block text-sm font-medium text-slate-300 mb-2" data-tooltip="return-by">Return by <span class="text-slate-500">(optional, for checkout)</span></label>
        <input type="date" id="return_by" name="return_by" class="input-atems w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2" placeholder="Expected return date">
      </div>
      <button type="submit" class="btn-atems w-full py-3 px-4 rounded-lg font-semibold text-lg">
        Submit
      </button>
    </form>
    <div id="js-messages" class="mt-4"></div>
  </div>

  <!-- Camera scan modal -->
  <div id="scanModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
    <div class="bg-slate-800 border border-slate-600 rounded-xl p-4 max-w-lg w-full">
      <div class="flex justify-between items-center mb-3">
        <h3 class="font-semibold text-slate-200">Scan with camera</h3>
        <button type="button" id="scanModalClose" class="text-slate-400 hover:text-white px-2 py-1">✕</button>
      </div>
      <div id="qrReader" class="w-full rounded-lg overflow-hidden bg-slate-900"></div>
      <p class="text-slate-500 text-xs mt-2">Point camera at QR code or barcode.</p>
    </div>
  </div>
</div>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script src="{{ url_for('static', filename='styles/js/checkinout.js') }}"></script>
{% endblock %}
